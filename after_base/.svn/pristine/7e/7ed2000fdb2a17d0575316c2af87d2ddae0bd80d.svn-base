error_log  stderr  notice;

worker_processes  auto;
events  {
    multi_accept  on;
    use  epoll;
    worker_connections  1024;
}

stream  {
    upstream  kube_apiserver  {
        least_conn;
        server 172.16.17.123:6443;
        
    }

    upstream  docker_server  {
        least_conn;
        server  127.0.0.1:52375  ;
    }

    server  {
        listen     0.0.0.0:6443;
        proxy_pass     kube_apiserver;
        proxy_timeout  10m;
        proxy_connect_timeout  1s;
    }
    server  {
        listen  0.0.0.0:2375;
        proxy_connect_timeout  60s;
        proxy_timeout  10m;
        proxy_pass  docker_server;
        allow  172.16.17.122;
        allow  172.16.17.122;
        allow  172.16.17.122;
        allow  127.0.0.1;
        deny  all;
    }
}
